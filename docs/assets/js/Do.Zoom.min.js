/*
 doZoom 0.1.5
 http://domeraki.github.io/doZoom
 MIT licensed

 Copyright (C) 2017 domeraki.com - A project by DoMeraki
*/
(function(b,c){"function"===typeof define&&define.amd?define(["jquery"],function(b){c(b)}):"object"===typeof module&&module.exports?module.exports=b.DoZoom=c(require("jquery")):b.DoZoom=c(b.jQuery)})(this,function(b){function c(a,d){this.$targetParent=b(a);this.opts=b.extend({},u,d,"destroy");void 0===this.isInit&&this._init()}var p,q,r,t,k,l,g,h,f,e,m,n,u={srcAttribute:"bgsrc",noChild:!0,selector:".item",includeParent:!0,autoCover:!1,defaultSize:"cover",restSize:!1,restPosition:!1,showError:!0,errorMessage:"Faild to load image.",
hideError:!0,errorDuration:3,additionWidth:0,additionHeight:0,afterLoad:null,onHover:null,onMoveing:null,onLeave:null,onInitialized:null,onInitialize:null,onChange:null,debug:!1,loadingClass:"doZoom-loading",readyClass:"doZoom-ready",hoverClass:"doZoom-hover",leaveClass:"doZoom-leave",movingClass:"doZoom-moving",errorClass:"doZoom-error",notifyClass:"doZoom-notify"};c.prototype._init=function(){b.isFunction(this.opts.onInitialize)&&this.opts.onInitialize.call(this);this.opts.debug&&this.__debug("Initialize doZoom");
this.$notify=b('<div class="doZoom-notify" />');this.isActiveNotify=this.isNotify=!1;this.$realTarget=this.$targetParent;this.opts.noChild||(this.$realTarget=this.$target=this.$targetParent.find(this.opts.selector));"undefined"==typeof this.lastoffset&&(this.lastoffset=this.$realTarget.offset());"undefined"==typeof this.$realTarget.attr(this.opts.srcAttribute)?(this.opts.errorMessage="src attribute not found ",this.__Error()):(this.$realTarget.css("background-image","url("+this.$realTarget.attr(this.opts.srcAttribute)+
")"),""!=this.opts.defaultSize&&this.$realTarget.css("background-size",this.opts.defaultSize),this.isError=!1);this.$event=this.$targetParent;this.opts.includeParent||this.opts.noChild||(this.$event=this.$target);this.$event.on({"mousemove.doZoom touchmove.doZoom":b.proxy(this.__move,this),"mouseleave.doZoom touchend.doZoom":b.proxy(this.__unHover,this),"mouseenter.doZoom touchstart.doZoom":b.proxy(this.__hover,this)});this.opts.debug&&this.__debug("doZoom Initialized");b.isFunction(this.opts.onInitialized)&&
this.opts.onInitialized.call(this,{target:this.$realTarget})};c.prototype.show=function(a){if(!this.isReady){var d=this._loadImage(this.$realTarget.attr(this.opts.srcAttribute));this.$realTarget.attr("imgwidth",d.width);this.$realTarget.attr("imgheight",d.height)}this.isError||(g=this.$realTarget.outerWidth()+this.opts.additionWidth,h=this.$realTarget.outerHeight()+this.opts.additionHeight,f=this.$realTarget.attr("imgwidth"),e=this.$realTarget.attr("imgheight"),this.isInit=!0,this._diff=g/h>f/e,this.opts.autoCover?
(m=f/e*h,n=e/f*g,p=m-g,q=n-h,f=m,e=n,this._diff?this.$realTarget.css("background-size","100% "+n+"PX"):this.$realTarget.css("background-size",m+"px 100%")):(p=f-g,q=e-h,this.$realTarget.css("background-size",f+"px "+e+"px")),r=p/g,t=q/h,b.isFunction(this.opts.beforeZoom)&&this.opts.beforeZoom.call(this,{imgWidth:imgWidth,imgHeight:e}),a&&this.moving(a))};c.prototype.__hover=function(a){this.Reshow=!1;var d=a.originalEvent.touches;b.isFunction(this.opts.onHover)&&this.opts.onHover.call(this);this.$realTarget.removeClass(this.opts.leaveClass).addClass(this.opts.hoverClass);
this.isMouseOver=!0;this.opts.debug&&this.__debug("hover function");d&&1!=d.length||(a.preventDefault(),this.isReady&&!this.Reshow||this.show(a))};c.prototype.__move=function(a){"undefined"!=typeof this.isReady&&this.isReady&&0!=this.$realTarget.attr("imgwidth")&&"undefined"!=typeof this.$realTarget.attr("imgwidth")&&this.isInit||(this.isReady=!1,this.show(a));this.isInit&&!this.isError&&(this.opts.debug&&this.__debug("Moving over background"),a.preventDefault(),this.moving(a))};c.prototype.__unHover=
function(){this.isError||(this.$realTarget.removeClass(this.opts.hoverClass+" "+this.opts.movingClass).addClass(this.opts.leaveClass),this.opts.restPosition&&this.$realTarget.animate({"background-position-y":"0px","background-position-x":"0px"},1E3),this.opts.autoCover&&(this._diff?this.$realTarget.css("background-size","100% "+n+"PX"):this.$realTarget.css("background-size",m+"px 100%")),this.opts.restSize&&this.$realTarget.css("background-size",""),this.isMouseOver=!1,this.opts.debug&&this.__debug("Unhover Background"),
b.isFunction(this.opts.onLeave)&&this.opts.onLeave.call(this))};c.prototype.__load=function(a){a.currentTarget.width&&(this.$notify.detach(),this.isReady=!0,this.isError=!1,this.opts.debug&&this.__debug("load"),this.$realTarget.removeClass(this.opts.loadingClass).addClass(this.opts.readyClass),b.isFunction(this.opts.afterLoad)&&this.opts.afterLoad.call(this))};c.prototype.__Error=function(){this.isError=!0;this.isReady=!1;this.opts.debug&&this.__debug("Faild to load image check srcAttribute.");this.$realTarget.removeClass(this.opts.loadingClass).addClass(this.opts.errorClass);
this.__showNotify()};c.prototype.__debug=function(a){console.log(a)};c.prototype.__showNotify=function(){this.isNotify||this.$realTarget.append(this.$notify);this.isNotify=!0;if(!this.isActiveNotify){var a=0;var b=this;a=this.opts.errorDuration;a="undefined"==typeof a?3E3:1>a?1E3:1E3*a;this.opts.showError&&(this.$notify.text(this.opts.errorMessage),this.$notify.css({top:"0"}),this.isActiveNotify=!0,this.opts.hideError&&(b.detachnotify=setTimeout(function(){b.__hideNotify()},a)))}};c.prototype.__hideNotify=
function(){this.$notify.stop(!0,!0).css({top:"-50px"});this.isActiveNotify=!1};c.prototype._loadImage=function(a){var d=new Image;d.src=a;this.$realTarget.addClass(this.opts.loadingClass);this.$zoom=b(d).on("error",b.proxy(this.__Error,this)).on("load",b.proxy(this.__load,this));this.isReady=0==d.width?!1:!0;return d};c.prototype.moving=function(a){if(!this.isError){0===a.type.indexOf("touch")?(a=a.touches||a.originalEvent.touches,k=a[0].pageX,l=a[0].pageY):(k=a.pageX||k,l=a.pageY||l);var d=this.lastoffset;
var c=l-d.top;a=k-d.left;var e=this.$realTarget.offset();if(d.top!=e.top||d.left!=e.left)c=l-e.top,a=k-e.left,b.isFunction(this.opts.onChange)&&this.opts.onChange.call(this,{change:e,old:d}),this.lastoffset=e;c=-1*Math.ceil(c*t);a=-1*Math.ceil(a*r);this.$realTarget.addClass(this.opts.movingClass);this.opts.autoCover?this._diff?this.$realTarget.css({"background-position-y":c,"background-position-x":"0px"}):this.$realTarget.css({"background-position-y":"0px","background-position-x":a}):this.$realTarget.css({"background-position-y":c,
"background-position-x":a});b.isFunction(this.opts.onMove)&&this.opts.onMove.call(this,{top:c,left:a})}};c.prototype.destroy=function(){console.log("DD");this.$event.off(".doZoom");this.$realTarget.removeClass(this.loadingClass,this.readyClass,this.hoverClass,this.leaveClass,this.movingClass,this.errorClass,this.notifyClass);delete this.$notify;this.$realTarget.css({"background-size":"","background-image":"","background-position":""})};b.fn.doZoom=function(a){return this.each(function(){var d=b.data(this,
"doZoom");"destroy"==a&&d.destroy();d?void 0===d.isInit&&d._init():b.data(this,"doZoom",new c(this,a))})}});